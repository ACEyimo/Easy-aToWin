# Easy-aToWin
骁龙845/855等机型从安卓到windows的刷机包

>此文档是ReadMe.md的简体中文版，无需重复阅读

----

大约两年之前（2022）就想做了，也完成了一小部分。
但当时项目官方不支持这种“傻瓜式操作”，且有一个恶意收费的“蛋”在，加上有两个问题难以解决，于是搁浅了。  
现在项目热度过去了，突然心血来潮就做出来了。
然后做的时候发现，小太阳ACA在很久之前就做过刷机包且把问题给解决了。

---

<center><b>
注：刷机包依赖文件名，请严格按照规则命名！！<br>
注：刷机包依赖文件名，请严格按照规则命名！！<br>
注：刷机包依赖文件名，请严格按照规则命名！！<br>
</b></center>

---

## 使用方法：
1. 刷入part包（分区包）
   - 重启到Recovery
   - 格式化data分区
   - 重启到系统（这一步很重要）
2. 重启到Recovery
3. 备份boot分区
4. 刷入flash包（刷写包）
5. 重启，然后享受

### 其他说明：
+ 刷完刷写包后，会向/sdcard/下发送一个当前分区（boot_a或boot_b）的备份，用于以后使用。  
+ 恢复分区包还没写，建议提前分别备份好win和安卓的boot镜像。  
+ 如果你想要换win系统，先恢复安卓boot镜像，再刷一遍刷写包即可。  
+ 如果你想要更换安卓系统，需要先备份win boot镜像，后刷入安卓，最后恢复win boot即可。
+ 当然你也可以在刷入分区包后，先刷你想要的安卓系统，再执行刷写包。

>注：**`请严格按照以上步骤执行`**  
以下内容包含对刷机包的**详细说明，务必仔细阅读**。  
最后一栏是**此机型**的使用指南及**特殊说明**，不同机型有不同内容，留空则表示此机型无特殊性。

---

## update-binary 版本说明：<br>例如：A.bc20240423
- A : 只有代码重构或大更新时才会变动
- b : 功能更新时会变动
- c : bug修复和局部代码逻辑优化会变动
- 20240423: 最后一次编辑时间

## 文件名以“-”符号分割，共有五个属性：
<center>
<b><span style="color:blue">类型</span>-<span style="color:red">型号</span>-<span style="color:green">输入值</span>-<span style="color:orange">占位符</span>-<span style="color:purple">版本</span>.zip</b><br>
<span style="color:blue">part</span>-<span style="color:red">enchilada</span>-<span style="color:green">auto</span>-<span style="color:orange">null</span>-<span style="color:purple">beta1.4</span>.zip</center>  
<span style="color:blue">flash</span>-<span style="color:red">enchilada</span>-<span style="color:green">Win11_23H3_v2.0rc2</span>-<span style="color:orange">null</span>-<span style="color:purple">beta1.4</span>.zip

---

1. “类型”标识刷机包类型。不能修改，会报错  

2. “型号”指定手机型号，不能修改，会报错  

3. “输入值”是刷机包根据输入内容进行调整的属性，可修改：
   + 分区包：用于设定Win分区大小
   + 刷写包：用于查找Windows镜像
   + 恢复包：设置恢复分区的模式

4. “占位符”会根据部分机型的特殊性执行特殊操作。默认为"null"，不可留空  

5. “版本”顾名思义，部分代码会使用此值，不推荐修改  

>注意：所有属性的值**必须严格遵循规则**，禁止使用除"**_**"和"**.**"以外的特殊字符<br>
>所有非法值导致的后果自负，包括但不限于刷机包报错、手机成砖、基带丢失等

### 分区包输入值说明：
   + auto：根据手机容量自动分配Win分区大小：
      - 64GB手机：Win分区大小为38GB
      - 128GB：70GB
      - 256GB：120GB
      - 512GB：240GB
      - ≥512GB：480GB
   + 整数（G/gb）：手动指定Win分区大小，示例为“128Gb”。要求：
      - 数值不能小于38G。
      - 计算后手机剩余空间必须保留19G以上。

#### 注意事项：
+ 对于容量超过256GB的设备，推荐手动设定Win分区大小。
+ 自定义容量不区分大小写，单位可省略。

### 刷写包输入值说明：
#### 值为Win镜像文件名。系统将按以下顺序在指定路径查找匹配文件：
1. U盘：`/usbstore/`
2. 内置储存：`/sdcrad/`
3. 下载目录：`/sdcard/Download/`
#### 查找规则：
+ 查找以`输入值`开头，`.wim`结尾的**首个文件**。
+ 如未找到，继续按路径顺序查找以`.mtip`结尾的**首个文件**。

`.mtip`是 某贼 Mindows工具的懒人包命名方案，这里指**全量包**。  
全量包的意思是，已包含了完成系统安装后的状态，即“已经进过系统”的镜像。无需经历常规安装后的系统初始化、驱动安装等步骤。  
相较于原版镜像能大幅减少安装问题（如蓝屏），显著缩短耗时。但可能预装特定软件，更改了系统设置等情况。  
如果你打算使用全量包，“输入值”无需修改。

## 流程及进度：
1. 验证机型 √
2. 验证刷机包 √
3. 验证分区 - 70%（部分功能待添加）
   - 分区包：
      + 验证是否官方分区 - 50%
      + 验证分区大小是否正确 - 50%
   - 刷写包：
      + 验证win和esp分区是否存在 √
      + 验证分区大小是否正确 - 50%
4. 执行操作 √
   - 分区包：
      + 缩小userdata分区 √
      + 创建esp和win分区 √
   - 刷写包：
      + 安装win镜像和引导文件 √
      + 备份安卓boot并刷入UEFI boot √
   - 恢复包：
      + default：只删除esp和win分区，扩大userdata分区 √
      + auto：删除userdata及以后分区，重建userdata分区 √
      + sgdisk：以指定的sgdisk备份恢复分区 √
5. 其他 - 25%
   - 读写配置 - 50%（未启用）
   - 输出日志 ×
   - 对UEFI引导配置文件进行修改 ×
   - 其他还没想到 ×
6. 完成

## 错误代码：
10 自定义函数判断两者不一致  
11 手机代号跟预设值不一致  
12 刷机包名称不合法  
  
20 获取分区信息错误  
21 设置分区时包含了浮点数  
22 设定的分区容量大于限制  
  
31 执行缩小分区时失败  
32 创建esp分区失败  
33 创建win分区失败  
34 设置esp分区启动标签失败  
  
41 没有找到win数据包  
42 发送esp引导文件失败  
43 安装win数据包失败  
  
50 挂载esp分区失败  
51 备份分区失败  
52 刷入镜像失败  
  
下列错误码所需要的代码暂未启用  
60 配置项不存在  
61 配置文件不存在  
62 读取到的配置值为空  

70 恢复分区包输入值非法  
71 default删除esp或win分区失败  
72 default扩大userdata分区时失败  
75 auto删除多余分区时失败  
76 auto删除userdata分区时失败  
77 auto创建userdata分区时失败  
78 sgdisk获取手机大小失败  
79 sgdisk恢复分区时失败（可能文件不存在）  


## 更新日志：
   A.aa202404??
      初代版本，完善了大部分功能
   A.ab202404??
      修复几个可能出现导致刷机包不可用的bug
   A.bb20240423
      增加了写入和读取配置函数
   A.bc20240514
      修复了无法发送备份文件到sdcard的bug
